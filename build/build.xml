<project name="build" default="clone" basedir=".">
    <taskdef resource="net/sf/antcontrib/antcontrib.properties"/>

    <property environment="env"/>
    <echo message="JAVA_HOME        :::: ${env.JAVA_HOME}" />
    <echo message="ANT HOME         :::: ${env.ANT_HOME}" />
    <echo message="ENVIRONMENT PATH :::: ${env.PATH}" />
	 <!--if>
                <not>
                        <isset property="env.ANT_HOME"/>
                </not>
                <then>
                        <fail message="ANT_HOME is not set in system enviroment. Kindly set it and proceed further" />
                </then>
        </if-->

	<if>
	    <not>
	        <isset property="trim_val"/>
	    </not>
	    <then>
	        <loadfile property="trim_val" srcfile="ddtools.properties">
	            <filterchain>
	              <trim/>
	            </filterchain>
	        </loadfile>
	        <echo message="${trim_val}" file="ddtools.properties"/>
	    </then>
	</if>

    <property file="ddtools.properties"/>
                                                                                                        
<!-- ============================================================================
       CALLING PRECHECK TASK
     =========================================================================-->

<target name="clone">

    <if>
        <not>
            <available file="${basedir}/hg_utils.zip" type="file" />
        </not>
        <then>
            <if>
    <available file="${user.home}/.wgetrc"/>
    <then>
        <loadfile property="user_credentials" srcfile="${user.home}/.wgetrc">
            <filterchain>
                <filterreader classname="org.apache.tools.ant.filters.HeadFilter">
                    <param name="lines" value="2" />
                </filterreader>
            </filterchain>
        </loadfile>
        <propertyregex property="wgetusername" input="${user_credentials}" regexp="(user)=([a-zA-Z.]*)" select="\2" override="true"/>
        <propertyregex property="wgetpassword" input="${user_credentials}" regexp="(password)=([0-9a-z_]*)" select="\2" override="true"/>
        <property name="wurl_username" value="${wgetusername}" />
        <property name="wurl_password" value="${wgetpassword}" />
    </then>
</if>
            <get src="https://build.zohocorp.com/integ/hg_utils/milestones/HG_UTILS_LOCAL_BUILD_BRANCH/HG_UTILS_LOCAL_BUILD_ZIDE_M1/hg_utils.zip" dest="${basedir}/hg_utils.zip" verbose="true" usetimestamp="false" ignoreerrors="true" username="${wurl_username}" password="${wurl_password}" />
            <unzip dest="${basedir}">
                <fileset dir="${basedir}" includes="hg_utils.zip" />
            </unzip>
            <delete file="${basedir}/hg_utils.zip"/>
        </then>
    </if>
 
    <copy file="${basedir}/hg_utils/build/library.xml" todir="." overwrite="true"/> 

    <if>
        <available file="${basedir}/custom_library.xml" type="file"/>
        <then>
            <concat destfile="${basedir}/library.xml" append="true">
                <filelist dir="." files="custom_library.xml"/>
            </concat>
        </then>
    </if>
    <copy todir="." overwrite="true">
        <fileset dir="${basedir}/hg_utils/build/rule">
            <exclude name=""/>
        </fileset>
    </copy>

    <ant antfile="${basedir}/checks.xml" target="precheck"/> 


</target>

<!-- ============================================================================
       CLEAN TASK
     =========================================================================-->

<target name="clean">
	<if>
		<available file="${basedir}/checks.xml" type="file"/>
		<then>
    		<ant antfile="${basedir}/checks.xml" target="clean"/> 
		</then>
		<else>
			<echo message="checks.xml is not available in current directory."/>
			<echo message="Please run local build and then try to clean"/>
		</else>
	</if>
</target>

</project>
