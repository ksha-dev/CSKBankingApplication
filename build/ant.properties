product_name=CSKBankingApplication
product_version=1.0

app.dir=${basedir}/../
webapp.src=${app.dir}/src/main/webapp
java.src=${app.dir}/src/main/java
dest.dir=${app.dir}/output
build_dir=${app.dir}/temp
jars.dir=${dest.dir}/WEB-INF/lib
temp.dir=${app.dir}/temp
dep.dir=${temp.dir}/dependencies
root.dir=${app.dir}/webapps/ROOT

#==============================================================================================#
#								BUILD ORDER 			 									   #
#==============================================================================================#

local_order=download,initialize,ddtool,copy,compile,clean
#,deploy

download_order=geturl:jedis,geturl:mysql,geturl:simplecaptcha,geturl:mail,geturl:grecaptcha,getdep:zoho_deps

initialize_order=mkdir:output,deletetask:output,mkdir:output,mkdir:classes,deletetask:classes

ddtool_order=javatask:dbo,srccompile:dbo,deletetask:dbo_java,deletetask:dbo_class,copyfiletask:dbojar

copy_order=copytask:webapp,copytask:ext_jar,copytask:zs_agent,copytask:zs_commons,copytask:zs_conf,copytask:zs_webapps_conf,copytask:zl_jars,copytask:zl_log4j,copytask:kms,copytask:db_agent,copytask:udt

compile_order=srccompile:source,deletetask:classes,exec:udtdigest

clean_order=deletetask:root,mkdir:root,movefiletask:output

deploy_orderexec:stop_server,exec:start_server

#==============================================================================================#
#						DOWNLOAD REQUIRED DEPENDENCY JARS 									   #
#==============================================================================================#

#Maven Dependencies

jedis_url=https://repo1.maven.org/maven2/redis/clients/jedis/5.1.2/jedis-5.1.2.jar

jedis_dest_zip=${temp.dir}/jedis-5.1.2.jar

mysql_url=https://repo1.maven.org/maven2/com/mysql/mysql-connector-j/8.2.0/mysql-connector-j-8.2.0.jar

mysql_dest_zip=${temp.dir}/mysql-connector-j-8.2.0.jar

simplecaptcha_url=https://repo1.maven.org/maven2/com/liferay/nl.captcha.simplecaptcha/1.1.1/nl.captcha.simplecaptcha-1.1.1.jar

simplecaptcha_dest_zip=${temp.dir}/nl.captcha.simplecaptcha-1.1.1.jar

mail_url=https://repo1.maven.org/maven2/com/sun/mail/javax.mail/1.6.2/javax.mail-1.6.2.jar

mail_dest_zip=${temp.dir}/javax.mail-1.6.2.jar

grecaptcha_url=https://repo1.maven.org/maven2/com/google/cloud/google-cloud-recaptchaenterprise/3.40.0/google-cloud-recaptchaenterprise-3.40.0.jar

grecaptcha_dest_zip=${temp.dir}/google-cloud-recaptchaenterprise-3.40.0.jar

#Zoho Dependencies

zoho_deps_urls=ZohoSecurity,logsclient,ddtool,encryptagent

ZohoSecurity=https://build.zohocorp.com/zoho/zohosecurity/milestones/master/ZOHOSECURITY_M2_34/ZohoSecurity.zip

logsclient=https://build.zohocorp.com/framework/zohologserver/milestones/Channel1/logsclient.zip

ddtool=https://build.zohocorp.com/nms5/dbuild/products/nms5/ddtool/Dec_23_2004/AdventNetDDTool_Dec_23_2004.zip

encryptagent=https://build.zohocorp.com/zoho/ear/milestones/master/EAR_M11_1/EncryptAgent.zip


#==============================================================================================#
#								DDTOOL JAVA FILES AND JAR CREATION							   #
#==============================================================================================#

# Generate Java Files for dd tables

dbo_java_classpath=${dep.dir}/ddtool/build_tools/lib

dbo_java_class=test.DDReader

dbo_java_args=-dd ${app.dir}/conf/CSKBank/cskbank-data-dictionary.xml -template ${dep.dir}/ddtool/build_tools/conf/ClassTemplate.vtl -outDir ${temp.dir}/java/

# Compile the java files to classes and create dbo jar

dbo_srccompile_classpath=.

dbo_srccompile_classes=${temp.dir}/classes

dbo_srccompile_jar=${temp.dir}/cskbank-dbo.jar

dbo_srccompile_srcdir=${temp.dir}/java

dbo_srccompile_includes=**

dbo_srccompile_jar_includes=**

#Clean up of temp folders

dbo_java_deletetask:${temp.dir}/java,**

dbo_class_deletetask:${temp.dir}/classes,**

# Copy the jar to src webapp lib folder

dbojar_copyfiletask=${temp.dir}/cskbank-dbo.jar,${webapp.dir}/WEB-INF/lib/cskbank-dbo.jar


#==============================================================================================#
#								COPY REQUIRED JAR AND OTHER FILES							   #
#==============================================================================================#

ext_jar_copytask=${temp.dir},${jars.dir},**.jar

zs_agent_copytask=${dep.dir}/ZohoSecurity/ZohoSecurity/lib/agent,${jars.dir},**.jar,slf4j-jdk*.jar

zs_commons_copytask=${dep.dir}/ZohoSecurity/ZohoSecurity/lib,${jars.dir},commons-io-*.jar

zs_conf_copytask=${dep.dir}/ZohoSecurity/ZohoSecurity/conf,${dest.dir}/WEB-INF/conf,**

zs_webapps_conf_copytask=${dep.dir}/ZohoSecurity/ZohoSecurity/webapps/WEB-INF,${dest.dir}/WEB-INF/conf,**

zl_jars_copytask=${dep.dir}/logsclient/logclient/lib,${jars.dir},**,slf4j-jdk*.jar

zl_log4j_copytask=${dep.dir}/logsclient/logclient/dependencyLibs,${jars.dir},log4j-slf4j-impl-*.jar

kms_copytask=${dep.dir}/encryptagent/lib,${jars.dir},EncryptUtil.jar

db_agent_copytask=${dep.dir}/encryptagent/lib,${jars.dir},DBEncryptAgent.jar

udt_copytask=${dep.dir}/encryptagent/resources,${app.dir}/conf/udt,me_ctext.dt

#==============================================================================================#
#								INITIALIZING AND CLEAN UP 									   #
#==============================================================================================#

#A folder is created just to remove previous outputs
output_dirname=${dest.dir}

output_deletetask=${dest.dir},**

classes_dirname=${app.dir}/build/classes

classes_deletetask=${app.dir}/build/classes,**

webapp_copytask=${webapp.src},${dest.dir},**

#==============================================================================================#
#								COMPILING AND CREATING WAR FILE 							   #
#==============================================================================================#

source_srccompile_classpath=${dest.dir}/WEB-INF/lib:${app.dir}/lib

source_srccompile_classes=${app.dir}/build/classes

source_srccompile_jar=${jars.dir}/${product_name}_${product_version}.jar

source_srccompile_srcdir=${java.src}

source_srccompile_includes=**

source_srccompile_excludes=com/cskbank/test/**,com/cskbank/consoleRunner/**,com/cskbank/consoleRunner/**/**

source_srccompile_jar_includes=**

udtdigest_exec_dir=${app.dir}/bin

udtdigest_exec_command=sh

udtdigest_exec_args=digest.sh ${app.dir}/conf/udt

#==============================================================================================#
#								DEPLOY TO MICKEY SERVER AS ROOT APP							   #
#==============================================================================================#

root_deletetask=${root.dir},**

root_dirname=${root.dir}

output_movefiletask=${dest.dir}/,${root.dir}/

stop_server_exec_dir=${app.dir}/bin

stop_server_exec_command=sh

stop_server_exec_args=app_ctl.sh shutdown

stop_server_exec_append=true

stop_server_exec_output=${app.dir}/logs/ant_out.txt

start_server_exec_dir=${app.dir}/bin

start_server_exec_command=sh

start_server_exec_args=app_ctl.sh run

start_server_exec_append=true

start_server_exec_output=${app.dir}/logs/ant_out.txt
